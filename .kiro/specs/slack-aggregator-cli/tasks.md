# 実装計画

## コミット指針
- 各サブタスク（例：2.1、4.2など）完了時にコミットを推奨
- 実装とテストは同一コミットに含める
- 機能が動作する状態でコミットする
- コミットメッセージは「feat: ConfigurationManagerクラスの実装」のような形式を推奨

- [x] 1. プロジェクト基盤の構築
  - package.jsonの作成とES Modules設定
  - Biome設定ファイルの作成
  - Vitestテスト環境の設定
  - npm scriptsでtest実行時にlint・formatも同時実行するよう設定
  - 基本的なディレクトリ構造の作成
  - _要件: 5.1, 5.3_

- [x] 2. 設定管理システムの実装
  - [x] 2.1 ConfigurationManagerクラスの実装
    - .env.jsonファイルの読み込み機能を実装
    - 設定の検証とトークン形式チェック機能を実装
    - チーム設定とチャンネルID取得機能を実装
    - ConfigurationManagerの単体テストを作成（正常系・異常系）
    - _要件: 1.1, 1.2, 2.1_

  - [x] 2.2 設定ファイルサンプルの作成
    - .env.json.exampleファイルを作成
    - チーム設定とハンドラー設定のサンプルを含める
    - _要件: 1.1, 2.1_

- [x] 3. ログシステムの実装
  - [x] 3.1 Loggerクラスの実装
    - STDERR出力でinfo、warn、errorメソッドを実装
    - 標準的なテキスト形式でのログ出力を実装
    - Loggerクラスの単体テストを作成（出力先とフォーマット検証）
    - _要件: 6.1, 6.2, 7.4_

- [x] 4. メッセージハンドラーシステムの実装
  - [x] 4.1 MessageHandlerインターフェースの実装
    - 抽象基底クラスとしてMessageHandlerを実装
    - handle、getName、isEnabledメソッドを定義
    - MessageHandlerの単体テストを作成（インターフェース検証）
    - _要件: 5.2, 5.4_

  - [x] 4.2 ConsoleOutputHandlerの実装
    - MessageHandlerを継承してConsoleOutputHandlerを実装
    - 「{team}/{channel}/{ユーザー} > 発言」形式での出力機能を実装
    - 改行の空白置換とテキストサニタイズ機能を実装
    - STDOUT出力でメッセージを表示
    - ConsoleOutputHandlerの単体テストを作成（フォーマット・サニタイズ検証）
    - _要件: 4.2, 7.1, 7.2, 7.5_

  - [x] 4.3 MessageProcessorクラスの実装
    - ハンドラー登録・削除機能を実装
    - メッセージ処理とハンドラー実行機能を実装
    - タイムスタンプによるメッセージソート機能を実装
    - MessageProcessorの単体テストを作成（ハンドラー管理・ソート検証）
    - _要件: 4.1, 4.3, 5.4_

- [x] 5. Slack API統合の実装
  - [x] 5.1 SlackClientクラスの実装
    - Socket Mode APIを使用した接続機能を実装
    - チャンネル購読とメッセージイベント処理を実装
    - 自動再接続機能を実装
    - SlackClientの単体テストを作成（モックAPI使用、接続・再接続検証）
    - _要件: 3.1, 3.2, 3.3, 3.4_

  - [x] 5.2 チーム管理機能の実装
    - TeamManagerクラスを実装
    - 複数チームの初期化と接続管理を実装
    - チーム固有エラー処理とシャットダウン機能を実装
    - TeamManagerの単体テストを作成（チーム管理・エラー処理検証）
    - _要件: 1.2, 1.3, 1.4, 6.4_

- [x] 6. エラーハンドリングの実装
  - [x] 6.1 設定エラー処理の実装
    - 無効なトークンの検出とエラーログ出力を実装
    - 設定ファイル不存在時の適切なエラー処理を実装
    - 設定エラー処理の単体テストを作成（エラーシナリオ検証）
    - _要件: 1.3, 6.2_

  - [x] 6.2 接続エラー処理の実装
    - Socket接続失敗時の自動再接続機能を実装
    - 認証エラー時のチーム無効化処理を実装
    - 接続エラー処理の単体テストを作成（再接続・無効化検証）
    - _要件: 3.3, 3.4, 6.2_

  - [x] 6.3 チャンネルエラー処理の実装
    - 無効なチャンネルIDの検出とスキップ機能を実装
    - アクセス権限エラーの処理を実装
    - チャンネルエラー処理の単体テストを作成（スキップ機能検証）
    - _要件: 2.3, 6.2_

- [x] 7. CLIエントリーポイントの実装
  - [x] 7.1 main.jsの実装
    - shebang（#!/usr/bin/env node）を追加
    - アプリケーション初期化とライフサイクル管理を実装
    - 起動時の接続状態表示を実装
    - main.jsの単体テストを作成（初期化・ライフサイクル検証）
    - _要件: 6.1, 6.4_

  - [x] 7.2 グレースフルシャットダウンの実装
    - SIGINT/SIGTERMシグナルハンドリングを実装
    - 全接続の適切な終了処理を実装
    - シャットダウン状態の表示を実装
    - シャットダウン処理の単体テストを作成（シグナル処理検証）
    - _要件: 6.4_

- [x] 8. 統合テストとデバッグ
  - [x] 8.1 基本機能の統合テスト
    - 設定読み込みから出力までの全体フローをテスト
    - 複数チーム接続のテスト
    - メッセージフォーマットの検証
    - _要件: 1.1-1.4, 2.1-2.4, 4.1-4.4_

  - [x] 8.2 エラーシナリオのテスト
    - 無効なトークンでの動作確認
    - 接続失敗時の再接続動作確認
    - 無効なチャンネルIDでの動作確認
    - _要件: 1.3, 2.3, 3.3, 3.4_

- [ ] 9. 将来拡張用ハンドラーの骨格実装
  - [ ] 9.1 NotificationHandlerの骨格実装
    - MessageHandlerを継承した基本構造を実装
    - 将来の通知機能のためのプレースホルダーを作成
    - NotificationHandlerの単体テストを作成（基本構造検証）
    - _要件: 5.2_

  - [ ] 9.2 SpeechHandlerの骨格実装
    - MessageHandlerを継承した基本構造を実装
    - 将来の読み上げ機能のためのプレースホルダーを作成
    - SpeechHandlerの単体テストを作成（基本構造検証）
    - _要件: 5.2_

- [ ] 10. ドキュメント作成
  - [ ] 10.1 README.mdの作成
    - プロジェクト概要と機能説明を記述
    - インストール方法（npm install -g slagg）を記述
    - .env.json設定ファイルの作成方法と形式を説明
    - 基本的な使用方法（slaggコマンド実行）を記述
    - 出力フォーマットの説明を記述
    - トラブルシューティング情報を記述
    - _要件: 1.1, 2.1, 4.2, 6.1, 6.2_
